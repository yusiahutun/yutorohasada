<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=robots content="index,follow,noarchive"><title>non-trivial designated initializers not supported - VBlogX</title><meta name=description content="I have a structure as follows: When I try to initialize it thus: I get this error: I think it wants the order of initialization exactly as it is declared, and local_connection is missing. I don't need to initialize it though, and setting it to NULL doesn't work."><meta name=author content="Some Person"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"VBlogX","url":"\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"\/non-trivial-designated-initializers-not-supported.html","name":"Non trivial designated initializers not supported"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Aldo Pusey"},"headline":"non-trivial designated initializers not supported","description":"I have a structure as follows: When I try to initialize it thus: I get this error: I think it wants the order of initialization exactly as it is declared, and local_connection is missing. I don\u0027t need to initialize it though, and setting it to NULL doesn\u0027t work.","inLanguage":"en","wordCount":888,"datePublished":"2024-06-20T00:00:00","dateModified":"2024-06-20T00:00:00","image":"\/img\/avatar-icon.png","keywords":[""],"mainEntityOfPage":"\/non-trivial-designated-initializers-not-supported.html","publisher":{"@type":"Organization","name":"\/","logo":{"@type":"ImageObject","url":"\/img\/avatar-icon.png","height":60,"width":60}}}</script><meta property="og:title" content="non-trivial designated initializers not supported"><meta property="og:description" content="I have a structure as follows: When I try to initialize it thus: I get this error: I think it wants the order of initialization exactly as it is declared, and local_connection is missing. I don't need to initialize it though, and setting it to NULL doesn't work."><meta property="og:image" content="/img/avatar-icon.png"><meta property="og:url" content="/non-trivial-designated-initializers-not-supported.html"><meta property="og:type" content="website"><meta property="og:site_name" content="VBlogX"><meta name=twitter:title content="non-trivial designated initializers not supported"><meta name=twitter:description content="I have a structure as follows: When I try to initialize it thus: I get this error: I think it wants the order of initialization exactly as it is declared, and local_connection is missing. I don't need â€¦"><meta name=twitter:image content="/img/avatar-icon.png"><meta name=twitter:card content="summary"><meta name=twitter:site content="@username"><meta name=twitter:creator content="@username"><link href=./img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.98.0"><link rel=alternate href=./index.xml type=application/rss+xml title=VBlogX><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://assets.cdnweb.info/hugo/bh/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://assets.cdnweb.info/hugo/bh/css/highlight.min.css><link rel=stylesheet href=https://assets.cdnweb.info/hugo/bh/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>non-trivial designated initializers not supported</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on June 20, 2024
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;5&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;888&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Aldo Pusey</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><img src=https://cdn.statically.io/img/cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto><p>I have a structure as follows:</p><pre><code>struct app_data { int port; int ib_port; unsigned size; int tx_depth; int sockfd; char *servername; struct ib_connection local_connection; struct ib_connection *remote_connection; struct ibv_device *ib_dev; }; </code></pre><p>When I try to initialize it thus:</p><pre><code>struct app_data data = { .port = 18515, .ib_port = 1, .size = 65536, .tx_depth = 100, .sockfd = -1, .servername = NULL, .remote_connection = NULL, .ib_dev = NULL }; </code></pre><p>I get this error:</p><pre><code>sorry, unimplemented: non-trivial designated initializers not supported </code></pre><p>I think it wants the order of initialization exactly as it is declared, and <code>local_connection</code> is missing. I don't need to initialize it though, and setting it to NULL doesn't work.</p><p>If I change it to this for g++, still get the same error:</p><pre><code>struct app_data data = { port : 18515, ib_port : 1, size : 65536, tx_depth : 100, sockfd : -1, servername : NULL, remote_connection : NULL, ib_dev : NULL }; </code></pre><span class=d-none itemprop=commentCount>9</span><h2 class=mb0 data-answercount=7>7 Answers</h2><p>the order of initialization needs to be in the exact order of declaration.</p><pre><code>typedef struct FOO { int a; int b; int c; }FOO; FOO foo = {.a = 1, .b = 2}; // OK FOO foo1 = {.a = 1}; // OK FOO foo2 = {.b = 2, .a = 1}; // Error sorry, unimplemented: non-trivial designated initializers not supported FOO foo3 = {.a = 1, .c = 2}; // Error sorry, unimplemented: non-trivial designated initializers not supported </code></pre><p>I understand that this means that the compiler has no support for name-oriented, out-of-order, member initialization.</p><p>Need to initialize the struct in the old fashioned way. I keep the variable names for clarity, but I have to initialize them in order, and not skip a variable.</p><p>I can stop the initialization at any variable, but can't initialize variables that come of that.</p><span class=d-none itemprop=commentCount>3</span><p>This does not work with g++. You are essentially using C constructs with C++. Couple of ways to get around it.</p><p>1) Remove the "." and change "=" to ":" when initializing.</p><pre><code>#include &lt;iostream&gt; using namespace std; struct ib_connection { int x; }; struct ibv_device { int y; }; struct app_data { int port; int ib_port; unsigned size; int tx_depth; int sockfd; char *servername; struct ib_connection local_connection; struct ib_connection *remote_connection; struct ibv_device *ib_dev; }; int main() { struct app_data data = { port : 18515, ib_port : 1, size : 65536, tx_depth : 100, sockfd : -1, servername : NULL, local_connection : {5}, remote_connection : NULL, ib_dev : NULL }; cout &lt;&lt; "Hello World" &lt;&lt; endl; return 0; } </code></pre><p>2) Use g++ -X c. (Not recommended) or put this code in extern C [Disclaimer, I have not tested this]</p><span class=d-none itemprop=commentCount>12</span><p>I have noticed my GCC compiler has some trick to accept .fieldname=value assigments but will only compile if fields come in the same order they are declared in the struct.</p><p>I was able to init this struct in two ways. The one with names improves readability and reduces the risk of assigning the wrong data if the struct field order is later changed.</p><pre><code>//Declare struct typedef struct { uint32_t const * p_start_addr; uint32_t const * p_end_addr; fs_cb_t const callback; uint8_t const num_pages; uint8_t const priority; } fs_config_t; //Assign unnamed fs_config_t fs_config { (uint32_t*)0x00030000, // uint32_t const * p_start_addr; (uint32_t*)0x00038000, // uint32_t const * p_end_addr; fs_evt_handler, // fs_cb_t const callback; 8, // uint8_t const num_pages; 0xFE // uint8_t const priority; }; //Assign to named fields static fs_config_t fs_config1 { .p_start_addr = (uint32_t*)0x00030000, .p_end_addr = (uint32_t*)0x00038000, .callback = fs_evt_handler, .num_pages = 8, .priority = 0xFE }; </code></pre><p>The rule of thumb is:</p><li>Assign to .name=value fields</li><li>Assign in the order they where declared</li><li>Include all fields in the assigment</li><span class=d-none itemprop=commentCount>2</span><p>Since none of the other approaches worked for me with the Arduino IDE, I decided to simply set each field separately:</p><pre><code>struct app_data data; data.port = 18515; data.ib_port = 1; data.size = 65536; data.tx_depth = 100; data.sockfd = -1; data.servername = NULL; data.remote_connection = NULL; data.ib_dev = NULL; </code></pre><span class=d-none itemprop=commentCount>2</span><p>Unfortunately, C++ doesn't support designated initialisers. GCC still lets you use them (as an extension) but you must initialise members in the same order as they are listed in the <code>struct</code>.</p><p>Another workaround is to use an immediately invoked lambda:</p><pre class="lang-cpp prettyprint-override"><code>constexpr fuse_operations fuse_ops = []{ fuse_operations ops{}; ops.destroy = wiifs_destroy; ops.getattr = wiifs_getattr; ops.access = wiifs_access; // ... return ops; }(); </code></pre><p>I personally prefer this solution because it is perfectly standard C++, it lets you initialise fields in the order you want, skip the ones you don't need and default initialise the rest. And the compiler is still <a href=# rel="nofollow noreferrer">able to optimise this</a>. Do note that this will only work with C++17 or newer.</p><span class=d-none itemprop=commentCount>2</span><p>I was hit by a variant of this. Consider this broken code:</p><pre><code>enum { S_START, S_ANOTHER, S_LAST } STATES; const char* STATE_NAMES[] = { [S_START] = "S_START", [S_LAST] = "S_LAST", }; int main() { } </code></pre><p>Here's the error message:</p><pre><code>a.cpp:10:1: sorry, unimplemented: non-trivial designated initializers not supported 10 | }; </code></pre><p>The problem was that I forgot to define S_ANOTHER entry in STATE_NAMES.</p><span class=d-none itemprop=commentCount>0</span><p>Also note that, as the original question stated, the order of the member expressions matter. I noticed that if I would like to only initialize "size" in the previous example, I need to put expressions for .port and .ib_port before. Otherwise I get the error "sorry, unimplemented: non-trivial designated initializers not supported" Not that intuitive...</p><span class=d-none itemprop=commentCount>1</span><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmirpJawrLvVnqmfpJ%2Bse6S7zGiorp2jqbawutJoampqYWqGeH2Op6anZaSntre1wKVknZ2jnrSvrdOem2ahnp7Bqq3LorGeqqNiu7DAjKysqaifp8GmsA%3D%3D</p><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=%2fnon-trivial-designated-initializers-not-supported.html&text=non-trivial%20designated%20initializers%20not%20supported&via=username" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=%2fnon-trivial-designated-initializers-not-supported.html" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=%2fnon-trivial-designated-initializers-not-supported.html&title=non-trivial%20designated%20initializers%20not%20supported" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=%2fnon-trivial-designated-initializers-not-supported.html&title=non-trivial%20designated%20initializers%20not%20supported" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=%2fnon-trivial-designated-initializers-not-supported.html&title=non-trivial%20designated%20initializers%20not%20supported" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=%2fnon-trivial-designated-initializers-not-supported.html&description=non-trivial%20designated%20initializers%20not%20supported" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section></article><ul class="pager blog-pager"><li class=previous><a href=./tom-cruise-demands-custody-suri-cruise-jamie-foxx.html data-toggle=tooltip data-placement=top title="Tom Cruise Demands Custody Suri Cruise  Battle With Katie Holmes  Hollywood Life">&larr; Previous Post</a></li><li class=next><a href=./mitch-pileggi-wiki-age-career-relationship-net-worth-other-facts.html data-toggle=tooltip data-placement=top title="Mitch Pileggi Wiki, Age, Career, Relationship, Net worth &amp;amp; Other Facts">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">All rights reserved
&nbsp;&bull;&nbsp;&copy;
2024
&nbsp;&bull;&nbsp;
<a href=./>VBlogX</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.98.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://assets.cdnweb.info/hugo/bh/js/main.js></script>
<script src=https://assets.cdnweb.info/hugo/bh/js/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://assets.cdnweb.info/hugo/bh/js/load-photoswipe.js></script>
<script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>